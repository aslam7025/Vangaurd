<%- include("../../views/partials/user/header") %>
<style>
  /* Modern Color Scheme and Variables */
  :root {
    --primary-color: #3a86ff;
    --secondary-color: #ff006e;
    --accent-color: #8338ec;
    --light-bg: #f8f9fa;
    --dark-text: #212529;
    --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --hover-shadow: 0 8px 18px rgba(0, 0, 0, 0.15);
    --border-radius: 12px;
    --transition-speed: 0.3s;
  }

  /* Main Container */
  .main-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  /* Shop Topbar */
  .shop-topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }

  /* Search Form */
  .search-form {
    display: flex;
    align-items: center;
    background-color: white;
    border-radius: 50px;
    overflow: hidden;
    max-width: 300px;
    box-shadow: var(--card-shadow);
    transition: box-shadow var(--transition-speed);
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .search-form:hover {
    box-shadow: var(--hover-shadow);
  }

  .search-input {
    flex: 1;
    padding: 12px 16px;
    font-size: 14px;
    border: none;
    outline: none;
    background-color: transparent;
    width: 100%;
  }

  .search-button {
    padding: 10px 20px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 14px;
    border-radius: 0 50px 50px 0;
    margin-left: auto;
    transition: background-color var(--transition-speed), transform var(--transition-speed);
  }

  .search-button:hover {
    background-color: var(--accent-color);
    transform: scale(1.05);
  }

  /* Product List Container */
  .product-list-container {
    display: flex;
    gap: 30px;
  }

  /* Sidebar */
  .sidebar {
    padding: 25px;
    border-radius: var(--border-radius);
    background-color: white;
    box-shadow: var(--card-shadow);
    margin-bottom: 20px;
    width: 250px;
    transition: transform var(--transition-speed), box-shadow var(--transition-speed);
  }

  .sidebar:hover {
    box-shadow: var(--hover-shadow);
  }

  .filter-section {
    margin-bottom: 25px;
  }

  .filter-title {
    font-weight: 600;
    margin-bottom: 15px;
    font-size: 18px;
    color: var(--dark-text);
    position: relative;
    padding-bottom: 10px;
  }

  .filter-title:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 3px;
    background-color: var(--primary-color);
    border-radius: 3px;
  }

  .category-brand-container ul {
    list-style: none;
    padding: 0;
  }

  .filter-item {
    margin: 8px 0;
    transition: transform var(--transition-speed);
  }

  .filter-item:hover {
    transform: translateX(5px);
  }

  .filter-item a {
    text-decoration: none;
    color: var(--dark-text);
    display: block;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background-color var(--transition-speed), color var(--transition-speed);
  }

  .filter-item a:hover {
    color: var(--primary-color);
    background-color: rgba(58, 134, 255, 0.1);
  }

  /* Price Filter */
  .price-filter {
    padding: 15px;
    background-color: white;
    border-radius: var(--border-radius);
    margin-top: 20px;
  }

  .price-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .price-button {
    padding: 12px 20px;
    background-color: white;
    color: var(--dark-text);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 50px;
    cursor: pointer;
    transition: all var(--transition-speed);
    text-align: center;
    font-size: 14px;
    font-weight: 500;
  }

  .price-button:hover {
    background-color: var(--primary-color);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(58, 134, 255, 0.3);
  }

  /* Product Grid */
  .product-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 25px;
    width: calc(100% - 280px);
  }

  /* Product Card */
  .product-card {
    width: calc(33.333% - 25px);
    background-color: white;
    border-radius: var(--border-radius);
    padding: 20px;
    text-align: center;
    position: relative;
    box-shadow: var(--card-shadow);
    transition: transform var(--transition-speed), box-shadow var(--transition-speed);
    overflow: hidden;
    border: none;
  }

  .product-card:hover {
    transform: translateY(-10px);
    box-shadow: var(--hover-shadow);
  }

  .product-card a {
    text-decoration: none;
    color: var(--dark-text);
  }

  .product-card img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    transition: transform var(--transition-speed);
    object-fit: cover;
    aspect-ratio: 1/1;
  }

  .product-card:hover img {
    transform: scale(1.05);
  }

  .product-card h4 {
    margin: 15px 0 8px;
    font-size: 16px;
    font-weight: 600;
    transition: color var(--transition-speed);
  }

  .product-card:hover h4 {
    color: var(--primary-color);
  }

  .product-card p {
    margin: 5px 0;
    color: #666;
  }

  /* Wishlist Button */
  .wishlist-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background-color: white;
    color: #ccc;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all var(--transition-speed);
    z-index: 1;
    opacity: 0.8;
    font-size: 18px;
  }

  .wishlist-btn:hover {
    color: var(--secondary-color);
    transform: scale(1.1);
    opacity: 1;
  }

  /* Add to Cart Button */
  .add-to-cart-btn {
    background-color: black;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    width: 100%;
    margin-top: 15px;
    font-weight: 500;
    transition: all var(--transition-speed);
    transform: translateY(5px);
    opacity: 0.9;
  }

  .product-card:hover .add-to-cart-btn {
    transform: translateY(0);
    opacity: 1;
  }

  .add-to-cart-btn:hover {
    background-color: #98780d;
    color: white;
    box-shadow: 0 5px 15px rgba(58, 134, 255, 0.3);
  }

  /* Price Display */
  .price-display {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
  }

  .current-price {
    font-weight: 600;
    color: var(--secondary-color);
    font-size: 18px;
  }

  .original-price {
    color: #888;
    text-decoration: line-through;
    font-size: 14px;
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 30px 0;
  }

  .pagination a {
    padding: 10px 15px;
    background-color: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    color: var(--dark-text);
    text-decoration: none;
    border-radius: 8px;
    transition: all var(--transition-speed);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  }

  .pagination a:hover {
    background-color: rgba(58, 134, 255, 0.1);
    transform: translateY(-3px);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
  }

  .pagination .active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  /* Responsive Design */
  @media (max-width: 992px) {
    .product-card {
      width: calc(50% - 25px);
    }
  }

  @media (max-width: 768px) {
    .product-list-container {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
    }
    
    .product-grid {
      width: 100%;
    }
  }

  @media (max-width: 576px) {
    .product-card {
      width: 100%;
    }
  }
  .search-form {
    z-index: 10;
  position: relative;
  max-width: 500px;
  display: flex 
}
.apply-button{
  background-color: rgb(4, 64, 71);
    color: white;
    padding: 12px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    width: 100%;
    margin-top: 15px;
    font-weight: 500;
    transition: all var(--transition-speed);
    transform: translateY(5px);
    opacity: 0.9;
}
.apply-button:hover{
  background-color:  rgb(31, 150, 190);
  color:  whitesmoke;
  box-shadow: 0 5px 15px rgba(58, 134, 255, 0.3);

}



</style>

<div class="main-container">
  <section class="shop-page container">
    <div class="shop-topbar">
      <div class="search-bar">
        <form action="/search" method="POST" class="search-form">
          <input type="text" name="query" placeholder="Search items..." class="search-input" />
          <button type="submit" class="search-button">Search</button>
        </form>
      </div>
    </div>
   
    <div class="product-list-container">
      <aside class="sidebar">
        <form action="/filter" method="GET" class="filter-form">
            <input type="hidden" name="apply" value="true">
            
            <!-- Categories Filter -->
            <div class="filter-section">
                <div class="filter-title">Categories</div>
                <div class="category-brand-container">
                    <ul>
                        <% for (let i = 0; i < category.length; i++) { %>
                            <li class="filter-item">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="category" value="<%= category[i]._id %>"
                                        <% if (selectedCategory && selectedCategory.includes(category[i]._id.toString())) { %> checked <% } %> />
                                    <span class="checkbox-mark"></span>
                                    <span class="checkbox-text"><%= category[i].name %> (<%= category[i].categoryOffer %>% Off)</span>
                                </label>
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>
            
            <!-- Brands Filter -->
            <div class="filter-section">
                <div class="filter-title">Brands</div>
                <div class="category-brand-container">
                    <ul>
                        <% for (let i = 0; i < brand.length; i++) { %>
                            <li class="filter-item">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="brand" value="<%= brand[i]._id %>"
                                        <% if (selectedBrand && selectedBrand.includes(brand[i]._id.toString())) { %> checked <% } %> />
                                    <span class="checkbox-mark"></span>
                                    <span class="checkbox-text"><%= brand[i].brandName %></span>
                                </label>
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>
            
            <!-- Price Range Filter -->
            <div class="filter-section">
                <div class="filter-title">Price Range</div>
                <div class="price-range-container">
                    <div class="price-inputs">
                        <div class="price-input-group">
                            <label for="minPrice">Min Price:</label>
                            <input 
                                type="number" 
                                id="minPrice" 
                                name="minPrice" 
                                placeholder="₹0"
                                min="0"
                                value="<%= minPrice || '' %>"
                                class="price-input"
                            >
                        </div>
                        <div class="price-input-group">
                            <label for="maxPrice">Max Price:</label>
                            <input 
                                type="number" 
                                id="maxPrice" 
                                name="maxPrice" 
                                placeholder="₹10000"
                                min="0"
                                value="<%= maxPrice || '' %>"
                                class="price-input"
                            >
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="apply-button">Apply Filters</button>
        </form>
        
        <!-- <button type="button" class="clear-button" onclick="clearAllFilters()">Clear Filters</button> -->
    </aside>
    

      <main class="product-grid">
        <% for(let i = 0; i < products.length; i++) { %>
          <div class="product-card">
            <span class="wishlist-btn" onclick="addToWishlist('<%=products[i]._id%>')">❤</span>
            <a href="/productDetails?id=<%=products[i]._id%>">
              <img src="/uploads/re-image/<%=products[i].productImage[0]%>" alt="<%=products[i].productName%>" />
              <h4><%=products[i].productName%></h4>
              <p><%=products[i].brandName%></p>
              <div class="price-display">
                <span class="current-price">₹<%=products[i].sizes[0].salePrice.toLocaleString('en-IN')%></span>
                <span class="original-price">₹<%=products[i].sizes[0].regularPrice.toLocaleString('en-IN')%></span>
              </div>
            </a>
             
            <a href="/productDetails?id=<%=products[i]._id%>"><button type="button"  class="add-to-cart-btn">Add to Cart</button></a>
            
            
          </div>
        <% } %>
      </main>
    </div>

    <div class="pagination">
      <% if (currentPage > 1) { %>
        <a class="btn" 
          href="/filter?page=<%= currentPage - 1 %><%= typeof selectedCategory !== 'undefined' && selectedCategory ? '&category=' + selectedCategory : '' %><%= typeof selectedBrand !== 'undefined' && selectedBrand ? '&brand=' + selectedBrand : '' %>">
          Prev
        </a>
      <% } %>

      <% for (let i = 1; i <= totalPages; i++) { %>
        <a class="btn <%= currentPage === i ? 'active' : '' %>" 
          href="/filter?page=<%= i %><%= typeof selectedCategory !== 'undefined' && selectedCategory ? '&category=' + selectedCategory : '' %><%= typeof selectedBrand !== 'undefined' && selectedBrand ? '&brand=' + selectedBrand : '' %>">
          <%= i %>
        </a>
      <% } %>

      <% if (currentPage < totalPages) { %>
        <a class="btn" 
          href="/filter?page=<%= currentPage + 1 %><%= typeof selectedCategory !== 'undefined' && selectedCategory ? '&category=' + selectedCategory : '' %><%= typeof selectedBrand !== 'undefined' && selectedBrand ? '&brand=' + selectedBrand : '' %>">
          Next
        </a>
      <% } %>
    </div>
  </section>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>
  function addToWishlist(productId) {
    $.ajax({
      url: "/add-wishlist",
      method: "POST",
      data: { productId: productId },
      success: (response) => {
        if (response.status) {
          Swal.fire({
            title: "Added to wishlist",
            text: "The product has been added to your wishlist",
            icon: "success",
            timer: 2000,
          })
        } else {
          Swal.fire({
            title: "Already in wishlist",
            text: response.message,
            timer: 2000,
          })
        }
      },
      error: (error) => {
        Swal.fire({
          title: "Error",
          text: "There was an error adding the product to your wishlist",
          icon: "error",
          timer: 2000
        })
      }
    })
  } 
</script>
<%- include("../../views/partials/user/footer") %>